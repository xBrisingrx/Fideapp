$("#modal").html("<%= j (render partial: 'modal_edit' ) %>")
set_currency_fn()
sale.reset()
sale.due_day = document.querySelector('.due_day').value
sale.precio = string_to_float_with_value(document.querySelector('#sale_project_price').value) 
$("#modal").modal('show')

document.getElementById('payment_plan_option').addEventListener('change', (event) => {
  document.getElementById('custom_payment_plan').classList.toggle('d-none', event.target.value !== 'custom')
})

document.getElementById('form-select-plan-data').addEventListener('submit', (event) => {
  event.preventDefault()
  event.stopImmediatePropagation()
  const form = new FormData()
  if ( document.getElementById('payment_plan_option').value === 'custom' ) {
    payment_plan.add_to_form(form, 'sale[payment_plan]')
  }
  form.append('sale[payment_plan][option]', document.getElementById('payment_plan_option').value)

  if( document.getElementById('payment_plan_option').value == '' ) {
    noty_alert('info', 'Debe seleccionar un plan de pagos')
    return
  }

  if( document.getElementById('payment_plan_option').value == 'custom' && document.getElementsByClassName('payment-plan').length == 0 ) {
    noty_alert('info', 'No se agrego un plan de pagos')
    return
  }

  fetch( event.target.action,{
    method: 'PATCH',
    headers: {           
      'X-CSRF-Token': document.getElementsByName('authenticity_token')[0].value,
    },
    body: form
  } )
  .then( response => response.json())
  .then( response => {
    if (response.status === 'success') {
      location.reload();
    } else {
      console.error('error')
    }
  } )
})