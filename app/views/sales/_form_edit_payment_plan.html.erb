<%= form_with( model: @sale, id: 'form-select-plan-data', remote:true,  
  class: 'needs-validation g-brd-around g-brd-gray-light-v4 g-pa-10 g-mb-10' ) do |form| %>
  <div class="form-group row">
    <div class=" col-md-4 col-lg-3 col-xl-2">
      <%= form.label :project_price, 'Valor del proyecto $: '%>
    </div>
    <div class="col-4">
      <%= form.text_field :project_price, class: 'form-control', value: format_currency(@project_price), disabled:true%>
    </div>
  </div>
  <div class="form-group row">
    <div class="col-4">
      <label for="">Opcion de pago:</label>
    </div>
    <div class="col-6">
      <select name="payment_plan[option]" id="payment_plan_option" class="form-control" required>
        <option value="">Seleccione plan de pago</option>
         <% for i in 1..@quantity_plans do %>
          <option value="<%= i %>"><%= i %></option>
         <% end %>
         <option value="custom">Personalizado</option>
      </select>
    </div>
  </div>
  <% for i in 1..@quantity_plans do %>
    <div class="col-12 mb-2">
      <table class="table table-responsive table-striped">
        <thead>
          <th></th>
          <th></th>
          <% if @first_pays.where( option: i ).count > 0 %>
            <% @first_pays.where( option: i ).each do |pay| %>
              <th> <%= I18n.t("date.month_names")[pay.date.month] %>-<%= pay.date.year %> </th>
            <% end %>
            <th></th>
          <% end %>
          <% if @quotes.where( option: i ).count > 0 %>
            <% @quotes.where( option: i ).each do |pay| %>
              <th> <%= I18n.t("date.month_names")[pay.date.month] %>-<%= pay.date.year %> </th>
            <% end %>
          <% end %>
        </thead>
        <tbody>
          <tr>
            <td></td>
            <td><b>Total</b></td>
            <% if @first_pays.where( option: i ).count > 0 %>
            <% @first_pays.where( option: i ).each do |pay| %>
              <td> Entrega <%= pay.number %> </td>
            <% end %>
            <td><b>Saldo</b></td>
          <% end %>
          <% if @quotes.where( option: i ).count > 0 %>
            <% @quotes.where( option: i ).each do |pay| %>
              <td> Cuota <%= pay.number %> </td>
            <% end %>
          <% end %>
          </tr>
          <tr>
            <td>Opcion <%= i %></td>
            <td><b>$<%= format_currency(@first_pays.where( option: i ).sum(:price) + @quotes.where( option: i ).sum(:price)) %></b></td>
            <% if @first_pays.where( option: i ).count > 0 %>
              <% @first_pays.where( option: i ).each do |pay| %>
                <td> $<%= format_currency(pay.price) %> </td>
              <% end %>
              <td><b>$<%= format_currency( @quotes.where( option: i ).sum(:price) ) %></b></td>
            <% end %>
            <% if @quotes.where( option: i ).count > 0 %>
              <% @quotes.where( option: i ).each do |pay| %>
                <td> $<%= format_currency(pay.price) %> </td>
              <% end %>
            <% end %>
          </tr>
        </tbody>
      </table>
      <hr class="w-50 g-my-20">
    </div>
  <% end %>

  <div id="custom_payment_plan" class='d-none'>
    <%= form.label :paid, 'Primer entrega:' , class: 'font-weight-bold' %>
    <%= render( partial: 'input_pay', locals: { cp: @cp, first_label: true } ) %>
    <div id="payment-list"></div>
    <p id="valor_restante"></p>

    <div class="form-group row">
    <div class="col-4 col-lg-3 col-xl-2">
      <%= form.label :number_of_payments, 'Cantidad de cuotas:'%>
      <%= form.number_field :number_of_payments, class: 'form-control rounded-0 number_of_payments', step:'0.01', required:true, onchange: "sale.update_number_of_payments(event)" %>
    </div>
      <div class="col-4 col-lg-4 col-xl-3">
        <%= form.label :fee_start_date, 'Vencimiento primer cuota' %>
        <%= form.date_field :fee_start_date, class: 'form-control rounded-0 date fee_start_date', onchange: "sale.update_date(event)" %>
      </div>
      <div class="col-4 col-lg-4 col-xl-3">
        <%= form.label :due_day, 'DÃ­a vencimiento cuota:'%>
        <%= form.number_field :due_day, class: 'form-control rounded-0 due_day', step:'0.01', value: @sale.due_day, onchange: "sale.update_due_day(event)" %>
      </div>
      <div class="col-2">
        <button type="button" class="btn u-btn-cyan btn-sm" title="Click para ayuda" onclick="fee_start_date_info()"><i class="fa fa-question"></i></button>
      </div>
      <div class="invalid-feedback msg_fecha_compra"></div>
    </div>

    <div class="form-group">
      <label class="d-flex align-items-center">
        <span class="mr-4">Editar monto y fecha de cuotas</span>
        <div class="u-check">
          <input class="g-hidden-xs-up g-pos-abs g-top-0 g-right-0" id="setear_cuotas" type="checkbox" onclick="sale.set_fees_manual(event)">
          <div class="u-check-icon-radio-v8">
            <i class="fa" data-check-icon="&#xf00c"></i>
          </div>
        </div>
      </label>
    </div>
    <div id="fees_list"></div>
    <p id='total_pagado_en_cuotas' ></p>
  </div>
  <div class="payment_plan_data"></div>

  <div class="actions">
    <%= form.submit 'Financiar', class: "btn u-btn-blue" %>
    <button type="button" class="btn u-btn-red" data-dismiss="modal" aria-label="Close"> Cancelar </button>
  </div>
<% end %>
